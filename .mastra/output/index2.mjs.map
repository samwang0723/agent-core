{"version":3,"file":"index2.mjs","sources":["../../src/mastra/workflows/weather.ts","../../src/mastra/tools/weather.ts","../../src/mastra/agents/weather.ts","../../src/mastra/index.ts"],"sourcesContent":["import { createStep, createWorkflow } from \"@mastra/core/workflows\";\nimport { z } from \"zod\";\n \nexport const forecastSchema = z.object({\n  date: z.string(),\n  maxTemp: z.number(),\n  minTemp: z.number(),\n  precipitationChance: z.number(),\n  condition: z.string(),\n  location: z.string(),\n});\n \nfunction getWeatherCondition(code: number): string {\n  const conditions: Record<number, string> = {\n    0: 'Clear sky',\n    1: 'Mainly clear',\n    2: 'Partly cloudy',\n    3: 'Overcast',\n    45: 'Foggy',\n    48: 'Depositing rime fog',\n    51: 'Light drizzle',\n    53: 'Moderate drizzle',\n    55: 'Dense drizzle',\n    61: 'Slight rain',\n    63: 'Moderate rain',\n    65: 'Heavy rain',\n    71: 'Slight snow fall',\n    73: 'Moderate snow fall',\n    75: 'Heavy snow fall',\n    95: 'Thunderstorm',\n  };\n  return conditions[code] || 'Unknown';\n}\n \nexport const fetchWeatherWithSuspend = createStep({\n  id: 'fetch-weather',\n  description: 'Fetches weather forecast for a given city',\n  inputSchema: z.object({}),\n  resumeSchema: z.object({\n    city: z.string().describe('The city to get the weather for'),\n  }),\n  outputSchema: forecastSchema,\n  execute: async ({ resumeData, suspend }) => {\n    if (!resumeData) {\n      return suspend({\n        message: 'Please enter the city to get the weather for',\n      });\n    }\n \n    const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(\n      resumeData.city,\n    )}&count=1`;\n    const geocodingResponse = await fetch(geocodingUrl);\n    const geocodingData = (await geocodingResponse.json()) as {\n      results: { latitude: number; longitude: number; name: string }[];\n    };\n \n    if (!geocodingData.results?.[0]) {\n      throw new Error(`Location '${resumeData.city}' not found`);\n    }\n \n    const { latitude, longitude, name } = geocodingData.results[0];\n \n    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=precipitation,weathercode&timezone=auto,&hourly=precipitation_probability,temperature_2m`;\n    const response = await fetch(weatherUrl);\n    const data = (await response.json()) as {\n      current: {\n        time: string;\n        precipitation: number;\n        weathercode: number;\n      };\n      hourly: {\n        precipitation_probability: number[];\n        temperature_2m: number[];\n      };\n    };\n \n    const forecast = {\n      date: new Date().toISOString(),\n      maxTemp: Math.max(...data.hourly.temperature_2m),\n      minTemp: Math.min(...data.hourly.temperature_2m),\n      condition: getWeatherCondition(data.current.weathercode),\n      precipitationChance: data.hourly.precipitation_probability.reduce((acc, curr) => Math.max(acc, curr), 0),\n      location: resumeData.city,\n    };\n \n    return forecast;\n  },\n});\n \nexport const weatherWorkflowWithSuspend = createWorkflow({\n  id: 'weather-workflow-with-suspend',\n  inputSchema: z.object({}),\n  outputSchema: forecastSchema,\n})\n  .then(fetchWeatherWithSuspend)\n  .commit();","import { createTool } from '@mastra/core/tools';\nimport { z } from \"zod\";\nimport { mastra } from \"..\";\nimport { forecastSchema } from \"../workflows/weather\";\n\nexport const startWeatherTool = createTool({\n  id: 'start-weather-tool',\n  description: 'Start the weather tool',\n  inputSchema: z.object({}),\n  outputSchema: z.object({\n    runId: z.string(),\n  }),\n  execute: async ({ context }) => {\n    const workflow = mastra.getWorkflow('weatherWorkflowWithSuspend');\n    const run = await workflow.createRunAsync();\n    await run.start({\n      inputData: {},\n    });\n \n    return {\n      runId: run.runId,\n    };\n  },\n});\n \nexport const resumeWeatherTool = createTool({\n  id: 'resume-weather-tool',\n  description: 'Resume the weather tool',\n  inputSchema: z.object({\n    runId: z.string(),\n    city: z.string().describe('City name'),\n  }),\n  outputSchema: forecastSchema,\n  execute: async ({ context }) => {\n    const workflow = mastra.getWorkflow('weatherWorkflowWithSuspend');\n    const run = await workflow.createRunAsync({\n      runId: context.runId,\n    });\n    const result = await run.resume({\n      step: 'fetch-weather',\n      resumeData: {\n        city: context.city,\n      },\n    });\n    switch (result.status) {\n      case 'success':\n        return result.result as z.infer<typeof forecastSchema>;\n      case 'failed':\n        throw result.error;\n      default:\n        throw new Error(`Unexpected workflow status: ${result.status}`);\n    }\n  },\n});","import { openai } from \"@ai-sdk/openai\";\nimport { Agent } from \"@mastra/core/agent\";\nimport { startWeatherTool, resumeWeatherTool } from \"../tools/weather\";\n\nexport const weatherAgentWithWorkflow = new Agent({\n  name: 'Weather Agent with Workflow',\n  instructions: `You are a helpful weather assistant that provides accurate weather information.\n \nYour primary function is to help users get weather details for specific locations. When responding:\n- Always ask for a location if none is provided\n- If the location name isnâ€™t in English, please translate it\n- If giving a location with multiple parts (e.g. \"New York, NY\"), use the most relevant part (e.g. \"New York\")\n- Include relevant details like humidity, wind conditions, and precipitation\n- Keep responses concise but informative\n \nUse the startWeatherTool to start the weather workflow. This will start and then suspend the workflow and return a runId.\nUse the resumeWeatherTool to resume the weather workflow. This takes the runId returned from the startWeatherTool and the city entered by the user. It will resume the workflow and return the result.\nThe result will be the weather forecast for the city.`,\n  model: openai('gpt-4o'),\n  tools: { startWeatherTool, resumeWeatherTool },\n});","import { Mastra } from \"@mastra/core\";\nimport { weatherAgentWithWorkflow } from \"./agents/weather\";\nimport { weatherWorkflowWithSuspend } from \"./workflows/weather\";\n\nexport const mastra: Mastra = new Mastra({\n  server: {\n    port: 3000, // Defaults to 4111\n    timeout: 10000, // Defaults to 30000 (30s)\n    cors: {\n      origin: [\"*\"], // Allow specific origins or '*' for all\n      allowMethods: [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"],\n      allowHeaders: [\"Content-Type\", \"Authorization\"],\n      credentials: false,\n    },\n    middleware: [\n      // {\n      //   handler: async (c, next) => {\n      //     // Example: Add authentication check\n      //     const authHeader = c.req.header(\"Authorization\");\n      //     if (!authHeader) {\n      //       return new Response(\"Unauthorized\", { status: 401 });\n      //     }\n \n      //     await next();\n      //   },\n      //   path: \"/api/*\",\n      // },\n      // Add a global request logger\n      async (c, next) => {\n        console.log(`${c.req.method} ${c.req.url}`);\n        await next();\n      },\n    ],\n  },\n  agents: { weatherAgentWithWorkflow },\n  workflows: { weatherWorkflowWithSuspend },\n});\n\n// const agent = mastra.getAgent('weatherAgentWithWorkflow');\n// const result = await agent.generate([\n//   {\n//     role: 'user',\n//     content: 'London',\n//   },\n// ]);\n\n// console.log(result);"],"names":[],"mappings":"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"}